@startuml Tourism Analytics Dashboard - Database Schema

!define TABLE(name) entity name << (T,#FFAAAA) >>
!define PRIMARY_KEY(x) <b><color:#b8860b><&key></color> x</b>
!define FOREIGN_KEY(x) <color:#aaaaaa><&link-intact></color> x
!define COLUMN(x) <color:#efefef><&media-record></color> x

title Tourism Analytics Dashboard - Entity Relationship Diagram\n20 Tables | 5 Django Apps

skinparam backgroundColor #FEFEFE
skinparam roundcorner 10
skinparam linetype ortho
skinparam class {
    BackgroundColor #F8F9FA
    BorderColor #343A40
    ArrowColor #495057
}

' ==========================================
'              USERS APP
' ==========================================
package "Users App" #E3F2FD {
    
    TABLE(users) {
        PRIMARY_KEY(id): INTEGER
        COLUMN(username): VARCHAR(150)
        COLUMN(email): VARCHAR(254)
        COLUMN(password): VARCHAR(128)
        COLUMN(first_name): VARCHAR(150)
        COLUMN(last_name): VARCHAR(150)
        COLUMN(role): VARCHAR(20)
        COLUMN(is_approved): BOOLEAN
        COLUMN(is_active): BOOLEAN
        COLUMN(is_staff): BOOLEAN
        COLUMN(is_superuser): BOOLEAN
        COLUMN(claimed_vendor_id): INTEGER
        COLUMN(claimed_stay_id): INTEGER
        COLUMN(claimed_place_id): INTEGER
        COLUMN(phone_number): VARCHAR(20)
        COLUMN(business_registration_number): VARCHAR(100)
        COLUMN(verification_document): FILE
        COLUMN(admin_notes): TEXT
        COLUMN(date_joined): DATETIME
        COLUMN(last_login): DATETIME
    }
    
    TABLE(password_reset_tokens) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(user_id): INTEGER
        COLUMN(token): VARCHAR(100)
        COLUMN(created_at): DATETIME
        COLUMN(used): BOOLEAN
    }
}

' ==========================================
'            ANALYTICS APP
' ==========================================
package "Analytics App" #E8F5E9 {
    
    TABLE(analytics_place) {
        PRIMARY_KEY(id): INTEGER
        COLUMN(name): VARCHAR(200)
        COLUMN(description): TEXT
        COLUMN(category): VARCHAR(100)
        COLUMN(city): VARCHAR(100)
        COLUMN(state): VARCHAR(100)
        COLUMN(country): VARCHAR(100)
        COLUMN(is_free): BOOLEAN
        COLUMN(price): DECIMAL(8,2)
        COLUMN(currency): VARCHAR(10)
        COLUMN(latitude): FLOAT
        COLUMN(longitude): FLOAT
        COLUMN(image_url): TEXT
        COLUMN(wikipedia_url): URL
        COLUMN(official_website): URL
        COLUMN(tripadvisor_url): URL
        COLUMN(google_maps_url): URL
        COLUMN(contact_phone): VARCHAR(20)
        COLUMN(contact_email): VARCHAR(254)
        COLUMN(address): TEXT
        COLUMN(opening_hours): TEXT
        COLUMN(best_time_to_visit): VARCHAR(200)
        COLUMN(is_open): BOOLEAN
        COLUMN(amenities): JSON
        FOREIGN_KEY(created_by_id): INTEGER
        FOREIGN_KEY(owner_id): INTEGER
        COLUMN(is_council_managed): BOOLEAN
        COLUMN(is_active): BOOLEAN
    }
    
    TABLE(analytics_socialpost) {
        PRIMARY_KEY(id): INTEGER
        COLUMN(platform): VARCHAR(50)
        COLUMN(post_id): VARCHAR(100)
        COLUMN(url): URL
        COLUMN(content): TEXT
        COLUMN(created_at): DATETIME
        COLUMN(fetched_at): DATETIME
        COLUMN(likes): INTEGER
        COLUMN(comments): INTEGER
        COLUMN(shares): INTEGER
        COLUMN(views): INTEGER
        COLUMN(sentiment): VARCHAR(20)
        COLUMN(sentiment_score): FLOAT
        COLUMN(confidence): FLOAT
        COLUMN(is_tourism): BOOLEAN
        FOREIGN_KEY(place_id): INTEGER
        FOREIGN_KEY(vendor_id): INTEGER
        FOREIGN_KEY(stay_id): INTEGER
        COLUMN(extra): JSON
    }
    
    TABLE(analytics_postraw) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(post_id): INTEGER
        COLUMN(content): TEXT
        COLUMN(metadata): JSON
        COLUMN(created_at): DATETIME
    }
    
    TABLE(analytics_postclean) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(raw_post_id): INTEGER
        COLUMN(content): TEXT
        COLUMN(sentiment): VARCHAR(20)
        COLUMN(keywords): JSON
        FOREIGN_KEY(poi_id): INTEGER
        COLUMN(created_at): DATETIME
    }
    
    TABLE(analytics_sentimenttopic) {
        PRIMARY_KEY(id): INTEGER
        COLUMN(topic): VARCHAR(100)
        COLUMN(sentiment): VARCHAR(20)
        COLUMN(count): INTEGER
        COLUMN(category): VARCHAR(100)
        COLUMN(date): DATE
    }
}

' ==========================================
'             VENDORS APP
' ==========================================
package "Vendors App" #FFF3E0 {
    
    TABLE(vendors_vendor) {
        PRIMARY_KEY(id): INTEGER
        COLUMN(name): VARCHAR(200)
        COLUMN(city): VARCHAR(120)
        COLUMN(cuisines): JSON
        COLUMN(description): TEXT
        COLUMN(established_year): INTEGER
        COLUMN(lat): FLOAT
        COLUMN(lon): FLOAT
        COLUMN(address): TEXT
        COLUMN(price_range): VARCHAR(10)
        COLUMN(contact_phone): VARCHAR(20)
        COLUMN(contact_email): VARCHAR(254)
        COLUMN(official_website): URL
        COLUMN(facebook_url): URL
        COLUMN(instagram_url): URL
        COLUMN(tripadvisor_url): URL
        COLUMN(google_maps_url): URL
        COLUMN(logo_url): URL
        COLUMN(cover_image_url): URL
        COLUMN(gallery_images): JSON
        COLUMN(amenities): JSON
        COLUMN(delivery_available): BOOLEAN
        COLUMN(takeaway_available): BOOLEAN
        COLUMN(reservation_required): BOOLEAN
        COLUMN(dress_code): VARCHAR(100)
        COLUMN(is_open): BOOLEAN
        COLUMN(is_halal): BOOLEAN
        COLUMN(is_active): BOOLEAN
        COLUMN(created_at): DATETIME
        COLUMN(updated_at): DATETIME
        FOREIGN_KEY(owner_id): INTEGER
    }
    
    TABLE(vendors_menuitem) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(vendor_id): INTEGER
        COLUMN(name): VARCHAR(200)
        COLUMN(description): TEXT
        COLUMN(category): VARCHAR(100)
        COLUMN(price): DECIMAL(10,2)
        COLUMN(currency): VARCHAR(3)
        COLUMN(is_available): BOOLEAN
        COLUMN(is_vegetarian): BOOLEAN
        COLUMN(is_halal): BOOLEAN
        COLUMN(spiciness_level): INTEGER
        COLUMN(allergens): JSON
        COLUMN(image_url): URL
    }
    
    TABLE(vendors_openinghours) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(vendor_id): INTEGER
        COLUMN(day_of_week): INTEGER
        COLUMN(open_time): TIME
        COLUMN(close_time): TIME
        COLUMN(is_closed): BOOLEAN
    }
    
    TABLE(vendors_review) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(vendor_id): INTEGER
        COLUMN(rating): INTEGER
        COLUMN(comment): TEXT
        COLUMN(author_name): VARCHAR(100)
        COLUMN(date): DATETIME
        COLUMN(verified_visit): BOOLEAN
        COLUMN(food_rating): INTEGER
        COLUMN(service_rating): INTEGER
        COLUMN(ambience_rating): INTEGER
        COLUMN(value_rating): INTEGER
    }
    
    TABLE(vendors_promotion) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(vendor_id): INTEGER
        COLUMN(title): VARCHAR(200)
        COLUMN(description): TEXT
        COLUMN(start_date): DATE
        COLUMN(end_date): DATE
        COLUMN(discount_percentage): INTEGER
        COLUMN(discount_amount): DECIMAL(10,2)
        COLUMN(promo_code): VARCHAR(50)
        COLUMN(is_active): BOOLEAN
    }
    
    TABLE(vendors_reservation) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(vendor_id): INTEGER
        COLUMN(customer_name): VARCHAR(100)
        COLUMN(customer_email): VARCHAR(254)
        COLUMN(customer_phone): VARCHAR(20)
        COLUMN(date): DATE
        COLUMN(time): TIME
        COLUMN(party_size): INTEGER
        COLUMN(special_requests): TEXT
        COLUMN(status): VARCHAR(20)
    }
}

' ==========================================
'              STAYS APP
' ==========================================
package "Stays App" #F3E5F5 {
    
    TABLE(stays_stay) {
        PRIMARY_KEY(id): INTEGER
        COLUMN(name): VARCHAR(200)
        COLUMN(type): VARCHAR(20)
        COLUMN(district): VARCHAR(120)
        COLUMN(rating): DECIMAL(3,1)
        COLUMN(priceNight): DECIMAL(8,2)
        COLUMN(amenities): JSON
        COLUMN(lat): FLOAT
        COLUMN(lon): FLOAT
        COLUMN(images): JSON
        COLUMN(main_image): FILE
        COLUMN(landmark): VARCHAR(200)
        COLUMN(distanceKm): DECIMAL(5,2)
        COLUMN(is_active): BOOLEAN
        COLUMN(is_open): BOOLEAN
        COLUMN(is_internal): BOOLEAN
        COLUMN(contact_email): VARCHAR(255)
        COLUMN(contact_phone): VARCHAR(20)
        COLUMN(contact_whatsapp): VARCHAR(20)
        COLUMN(booking_com_url): URL
        COLUMN(agoda_url): URL
        COLUMN(booking_provider): VARCHAR(50)
        FOREIGN_KEY(owner_id): INTEGER
    }
    
    TABLE(stays_stayimage) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(stay_id): INTEGER
        COLUMN(image): FILE
        COLUMN(caption): VARCHAR(200)
        COLUMN(is_primary): BOOLEAN
        COLUMN(order): INTEGER
        COLUMN(uploaded_at): DATETIME
    }
}

' ==========================================
'              EVENTS APP
' ==========================================
package "Events App" #FFEBEE {
    
    TABLE(events_event) {
        PRIMARY_KEY(id): INTEGER
        COLUMN(title): VARCHAR(200)
        COLUMN(description): TEXT
        COLUMN(start_date): DATETIME
        COLUMN(end_date): DATETIME
        COLUMN(location_name): VARCHAR(200)
        COLUMN(city): VARCHAR(120)
        COLUMN(lat): FLOAT
        COLUMN(lon): FLOAT
        COLUMN(tags): JSON
        COLUMN(is_published): BOOLEAN
        COLUMN(expected_attendance): INTEGER
        COLUMN(actual_attendance): INTEGER
        COLUMN(image_url): TEXT
        FOREIGN_KEY(created_by_id): INTEGER
        COLUMN(max_capacity): INTEGER
        COLUMN(requires_approval): BOOLEAN
        COLUMN(registration_form_config): JSON
        COLUMN(approval_message): TEXT
        COLUMN(recurrence_type): VARCHAR(20)
        COLUMN(recurrence_end_date): DATE
        FOREIGN_KEY(parent_event_id): INTEGER
        COLUMN(is_recurring_instance): BOOLEAN
    }
    
    TABLE(events_eventregistration) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(user_id): INTEGER
        FOREIGN_KEY(event_id): INTEGER
        COLUMN(status): VARCHAR(20)
        COLUMN(form_data): JSON
        COLUMN(admin_notes): TEXT
        FOREIGN_KEY(reviewed_by_id): INTEGER
        COLUMN(reviewed_at): DATETIME
        COLUMN(contact_name): VARCHAR(200)
        COLUMN(contact_email): VARCHAR(254)
        COLUMN(contact_phone): VARCHAR(20)
        COLUMN(registered_at): DATETIME
        COLUMN(updated_at): DATETIME
    }
    
    TABLE(events_eventregistrationform) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(event_id): INTEGER
        COLUMN(title): VARCHAR(200)
        COLUMN(description): TEXT
        COLUMN(confirmation_message): TEXT
        COLUMN(allow_guest_registration): BOOLEAN
        COLUMN(created_at): DATETIME
        COLUMN(updated_at): DATETIME
    }
    
    TABLE(events_eventregistrationfield) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(form_id): INTEGER
        COLUMN(label): VARCHAR(200)
        COLUMN(field_type): VARCHAR(20)
        COLUMN(is_required): BOOLEAN
        COLUMN(placeholder): VARCHAR(200)
        COLUMN(help_text): VARCHAR(500)
        COLUMN(options): JSON
        COLUMN(order): INTEGER
        COLUMN(min_length): INTEGER
        COLUMN(max_length): INTEGER
        COLUMN(pattern): VARCHAR(500)
        COLUMN(created_at): DATETIME
    }
    
    TABLE(events_eventreminder) {
        PRIMARY_KEY(id): INTEGER
        FOREIGN_KEY(user_id): INTEGER
        FOREIGN_KEY(event_id): INTEGER
        COLUMN(reminder_time): VARCHAR(20)
        COLUMN(is_sent): BOOLEAN
        COLUMN(sent_at): DATETIME
        COLUMN(created_at): DATETIME
    }
}

' ==========================================
'            RELATIONSHIPS
' ==========================================

' Users relationships
password_reset_tokens }o--|| users : "user_id"

' Places relationships
analytics_place }o--o| users : "created_by_id"
analytics_place }o--o| users : "owner_id"

' SocialPost relationships
analytics_socialpost }o--o| analytics_place : "place_id"
analytics_socialpost }o--o| vendors_vendor : "vendor_id"
analytics_socialpost }o--o| stays_stay : "stay_id"

' PostRaw and PostClean relationships
analytics_postraw }o--|| analytics_socialpost : "post_id"
analytics_postclean |o--|| analytics_postraw : "raw_post_id"
analytics_postclean }o--o| analytics_place : "poi_id"

' Vendor relationships
vendors_vendor }o--o| users : "owner_id"
vendors_menuitem }o--|| vendors_vendor : "vendor_id"
vendors_openinghours }o--|| vendors_vendor : "vendor_id"
vendors_review }o--|| vendors_vendor : "vendor_id"
vendors_promotion }o--|| vendors_vendor : "vendor_id"
vendors_reservation }o--|| vendors_vendor : "vendor_id"

' Stay relationships
stays_stay }o--o| users : "owner_id"
stays_stayimage }o--|| stays_stay : "stay_id"

' Event relationships
events_event }o--o| users : "created_by_id"
events_event }o--o| events_event : "parent_event_id"
events_eventregistration }o--o| users : "user_id"
events_eventregistration }o--|| events_event : "event_id"
events_eventregistration }o--o| users : "reviewed_by_id"
events_eventregistrationform |o--|| events_event : "event_id"
events_eventregistrationfield }o--|| events_eventregistrationform : "form_id"
events_eventreminder }o--|| users : "user_id"
events_eventreminder }o--|| events_event : "event_id"

@enduml
