@startuml Social Media Analytics Sequence

title Social Media Analytics Pipeline

skinparam backgroundColor #FEFEFE
skinparam sequenceArrowThickness 2

participant "Celery Beat\n(Scheduler)" as CB #EEEEEE
participant "Celery Worker" as CW #E8F5E9
participant "Social Media\nAPIs" as SM #LightBlue
participant "AI Service\n(Sentiment)" as AI #F3E5F5
database "Database" as DB #FFF3E0

CB -> CW: Trigger task\n(every 2 hours)
activate CW

loop For each platform
    CW -> SM: Fetch recent posts\n(Instagram, Twitter, Facebook)
    SM --> CW: Raw posts data
end

loop For each post
    CW -> CW: Filter tourism content
    
    CW -> AI: Analyze sentiment\n{content}
    AI -> AI: Process with NLP
    AI --> CW: {sentiment, score, confidence}
    
    CW -> AI: Extract keywords
    AI --> CW: {keywords, entities}
    
    CW -> DB: Find matching Place/Vendor
    DB --> CW: Related entity (if found)
    
    CW -> DB: INSERT SocialPost
    DB --> CW: Post saved
end

CW -> DB: UPDATE engagement metrics
CW -> DB: UPDATE SentimentTopic aggregates

deactivate CW

@enduml
