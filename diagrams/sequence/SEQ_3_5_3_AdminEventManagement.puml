@startuml Admin Event Management Sequence

title Figure 3.10: Admin Event Management Sequence

skinparam backgroundColor #FEFEFE
skinparam sequenceArrowThickness 2
skinparam roundcorner 10

actor "Admin" as A #FFE0B2
participant "Frontend\n(React)" as FE #E3F2FD
participant "Backend\n(Django REST)" as BE #E8F5E9
database "Database\n(PostgreSQL)" as DB #FFF3E0
participant "Email Service\n(SMTP)" as EMAIL #FCE4EC
actor "Participant" as P #LightGreen

== Admin Login ==

A -> FE: Access Admin Portal
FE --> A: Display login form
A -> FE: Enter credentials
FE -> BE: POST /api/auth/login/\n{username, password}
BE -> DB: Validate admin credentials
DB --> BE: User (role='admin', is_approved=true)
BE --> FE: 200 OK {access_token, user: {role: 'admin'}}
FE --> A: Redirect to Admin Dashboard

== Create New Event ==

A -> FE: Navigate to "Events" > "Create Event"
FE --> A: Display event creation form

A -> FE: Fill event details:\n- Title, Description\n- Start/End Date\n- Location, City\n- Max Capacity\n- Registration Form Config\n- Requires Approval (checkbox)

FE -> FE: Validate form inputs

FE -> BE: POST /api/events/\n{title, description, start_date, end_date,\nlocation_name, city, max_capacity,\nregistration_form_config, requires_approval}

BE -> BE: Validate event data
BE -> DB: INSERT INTO events\n(created_by=admin_id, ...)
DB --> BE: Event created (ID)

BE --> FE: 201 Created\n{id, title, status: "published"}
FE --> A: "Event created successfully!"

== Manage Event Registrations ==

A -> FE: View event registrations
FE -> BE: GET /api/events/{event_id}/registrations/
BE -> DB: SELECT * FROM event_registrations\nWHERE event_id = {id}
DB --> BE: Registrations list
BE --> FE: [{id, user_name, email, status, form_data, ...}]
FE --> A: Display registrations table

== Review Pending Registrations ==

note over A, FE: For events with requires_approval=True

A -> FE: Filter by status "pending"
FE --> A: Show pending registrations

loop For each pending registration
    A -> FE: View registration details
    FE --> A: Show submitted form data
    
    alt Approve Registration
        A -> FE: Click "Approve"
        FE -> BE: POST /api/events/registrations/{reg_id}/approve/
        
        BE -> DB: UPDATE event_registrations\nSET status='confirmed'\nWHERE id={reg_id}
        DB --> BE: Registration approved
        
        BE -> DB: Get participant email
        DB --> BE: Participant details
        
        BE -> EMAIL: Send approval notification
        EMAIL --> P: "Registration Approved!\nYou're confirmed for {event_title}"
        
        BE --> FE: 200 OK {status: "confirmed"}
        FE --> A: Registration approved âœ“
        
    else Reject Registration
        A -> FE: Click "Reject" + Enter reason
        FE -> BE: POST /api/events/registrations/{reg_id}/reject/\n{reason: "..."}
        
        BE -> DB: UPDATE event_registrations\nSET status='rejected'\nWHERE id={reg_id}
        DB --> BE: Registration rejected
        
        BE -> EMAIL: Send rejection notification
        EMAIL --> P: "Registration Not Approved\nReason: {reason}"
        
        BE --> FE: 200 OK {status: "rejected"}
        FE --> A: Registration rejected
    end
end

== Update Event Details ==

A -> FE: Edit event information
FE -> BE: PATCH /api/events/{event_id}/\n{updated_fields}
BE -> DB: UPDATE events SET ... WHERE id={event_id}
DB --> BE: Event updated
BE --> FE: 200 OK {updated_event}
FE --> A: "Event updated successfully"

== Send Bulk Notification ==

A -> FE: Click "Notify All Participants"
FE --> A: Show notification composer

A -> FE: Compose message:\n{subject, body}
FE -> BE: POST /api/events/{event_id}/notify/\n{subject, message}

BE -> DB: SELECT email FROM event_registrations\nWHERE event_id={id} AND status='confirmed'
DB --> BE: List of participant emails

loop For each participant
    BE -> EMAIL: Send notification email
    EMAIL --> P: "{subject}\n{message}"
end

BE --> FE: 200 OK {sent_count: N}
FE --> A: "Notification sent to N participants"

== Cancel Event ==

A -> FE: Click "Cancel Event"
FE --> A: Confirm cancellation dialog

A -> FE: Confirm + Enter cancellation reason
FE -> BE: POST /api/events/{event_id}/cancel/\n{reason: "..."}

BE -> DB: UPDATE events\nSET is_published=False, status='cancelled'
DB --> BE: Event cancelled

BE -> DB: SELECT * FROM event_registrations\nWHERE event_id={id} AND status='confirmed'
DB --> BE: Confirmed registrations

loop Notify all confirmed participants
    BE -> EMAIL: Send cancellation notice
    EMAIL --> P: "Event Cancelled\n{event_title} has been cancelled.\nReason: {reason}"
end

BE --> FE: 200 OK {message: "Event cancelled"}
FE --> A: "Event cancelled. All participants notified."

== View Event Analytics ==

A -> FE: Navigate to Event Analytics
FE -> BE: GET /api/analytics/events/attendance-trend/
BE -> DB: Aggregate attendance data
DB --> BE: Attendance statistics
BE --> FE: {trend_data, totals}
FE --> A: Display charts and metrics

@enduml
