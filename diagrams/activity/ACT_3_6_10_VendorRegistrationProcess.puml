@startuml Vendor Registration Process Activity

title Figure 3.X: Vendor Registration Process Activity Diagram

skinparam backgroundColor #FEFEFE
skinparam ActivityBackgroundColor #E3F2FD
skinparam ActivityBorderColor #1976D2
skinparam ActivityDiamondBackgroundColor #FFF9C4
skinparam ActivityDiamondBorderColor #F57F17
skinparam ArrowColor #333333

|#FFE0B2|Vendor|
|#E8F5E9|System|
|#E1F5FE|Admin|
|#FCE4EC|Email Service|
|#FFF3E0|Database|

|Vendor|
start
:Access Tourism Portal;
:Click "Register as Vendor";

|System|
:Display Vendor Registration Form;

|Vendor|
:Fill Registration Details
== Account Information ==
- Email Address *
- Password *
- Confirm Password *
- Full Name *
- Phone Number

== Business Information ==
- Business Name *
- Business Type (Restaurant/Cafe/Shop)
- Description
- Cuisine Types (if restaurant)
- Address *
- City *
- State
- Country;

|System|
:Validate Registration Data;

if (Valid Data?) then (yes)
    :Check Email Uniqueness;
    
    |Database|
    :SELECT * FROM users
    WHERE email = {email};
    
    |System|
    if (Email Exists?) then (yes)
        |Vendor|
        :Display Error
        "Email already registered";
        stop
    else (no)
        :Hash Password (bcrypt);
        :Set role = 'vendor';
        :Set is_approved = FALSE;
        
        |Database|
        :INSERT INTO users
        (email, password, name,
        phone, role, is_approved,
        is_active = TRUE);
        
        :Get new user_id;
        
        :INSERT INTO vendors
        (owner_id = user_id,
        name, business_type,
        description, cuisines,
        address, city, state,
        country, is_approved = FALSE);
        
        |System|
        :Generate Email Verification Token;
        
        |Email Service|
        :Send Verification Email
        to Vendor;
        
        |System|
        :Notify Admin of
        New Pending Vendor;
        
        |Email Service|
        :Send Admin Notification
        "New vendor registration
        pending approval";
        
        |Vendor|
        :Display Success Message
        "Registration submitted!
        Please verify your email
        and wait for admin approval.";
        
        :Check Email for
        Verification Link;
        :Click Verification Link;
        
        |System|
        :Validate Token;
        
        if (Token Valid?) then (yes)
            |Database|
            :UPDATE users
            SET email_verified = TRUE
            WHERE id = {user_id};
            
            |Vendor|
            :Email Verified!
            Awaiting Admin Approval;
        else (no)
            |Vendor|
            :Display "Invalid or
            Expired Token";
        endif
    endif
else (no)
    |Vendor|
    :Display Validation Errors
    - Invalid email format
    - Password too weak
    - Required fields missing
    - Password mismatch;
endif

' === ADMIN APPROVAL WORKFLOW ===
|Admin|
:Login to Admin Portal;
:Navigate to "Pending Approvals";

|System|
:Fetch Pending Vendors;

|Database|
:SELECT u.*, v.*
FROM users u
JOIN vendors v ON u.id = v.owner_id
WHERE u.role = 'vendor'
AND u.is_approved = FALSE;

|Admin|
:Review Vendor Application
- Business Details
- Contact Information
- Business Type;

if (Approve Vendor?) then (yes)
    :Click "Approve";
    
    |Database|
    :UPDATE users
    SET is_approved = TRUE
    WHERE id = {vendor_user_id};
    
    :UPDATE vendors
    SET is_approved = TRUE
    WHERE owner_id = {vendor_user_id};
    
    |Email Service|
    :Send Approval Email
    "Congratulations! Your vendor
    account has been approved.
    You can now login and manage
    your business profile.";
    
    |Vendor|
    :Receive Approval Email;
    :Login to Vendor Portal;
    
    |System|
    :Grant Access to
    Vendor Dashboard;
    
    |Vendor|
    :Access Vendor Features
    - Edit Business Profile
    - Upload Menu/Images
    - View Analytics
    - Manage Reservations;
    
else (no)
    :Click "Reject";
    :Enter Rejection Reason;
    
    |Database|
    :UPDATE users
    SET is_active = FALSE
    WHERE id = {vendor_user_id};
    
    |Email Service|
    :Send Rejection Email
    "Your vendor application
    was not approved.
    Reason: {rejection_reason}";
    
    |Vendor|
    :Receive Rejection Email;
    :May Reapply with
    Corrected Information;
endif

stop

@enduml
