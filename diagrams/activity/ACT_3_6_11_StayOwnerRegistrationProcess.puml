@startuml Stay Owner Registration Process Activity

title Figure 3.X: Stay Owner Registration Process Activity Diagram

skinparam backgroundColor #FEFEFE
skinparam ActivityBackgroundColor #E3F2FD
skinparam ActivityBorderColor #1976D2
skinparam ActivityDiamondBackgroundColor #FFF9C4
skinparam ActivityDiamondBorderColor #F57F17
skinparam ArrowColor #333333

|#FFE0B2|Stay Owner|
|#E8F5E9|System|
|#E1F5FE|Admin|
|#FCE4EC|Email Service|
|#FFF3E0|Database|

|Stay Owner|
start
:Access Tourism Portal;
:Click "Register as Stay Owner";

|System|
:Display Stay Owner
Registration Form;

|Stay Owner|
:Fill Registration Details
== Account Information ==
- Email Address *
- Password *
- Confirm Password *
- Full Name *
- Phone Number

== Property Information ==
- Property Name *
- Property Type *
  (Hotel/Resort/Homestay/
  Guesthouse/Hostel/Villa)
- Description
- Star Rating (1-5)
- Address *
- City *
- State
- Country

== Pricing Details ==
- Base Price per Night *
- Currency (MYR)

== Amenities ==
☐ WiFi
☐ Swimming Pool
☐ Parking
☐ Air Conditioning
☐ Restaurant
☐ Room Service
☐ Gym
☐ Spa
☐ Beach Access
☐ Pet Friendly;

|System|
:Validate Registration Data;

if (Valid Data?) then (yes)
    :Check Email Uniqueness;
    
    |Database|
    :SELECT * FROM users
    WHERE email = {email};
    
    |System|
    if (Email Exists?) then (yes)
        |Stay Owner|
        :Display Error
        "Email already registered";
        stop
    else (no)
        :Hash Password (bcrypt);
        :Set role = 'stay_owner';
        :Set is_approved = FALSE;
        
        |Database|
        :INSERT INTO users
        (email, password, name,
        phone, role, is_approved,
        is_active = TRUE);
        
        :Get new user_id;
        
        :INSERT INTO stays
        (owner_id = user_id,
        name, stay_type,
        description, star_rating,
        address, city, state,
        country, base_price,
        currency, amenities,
        is_approved = FALSE,
        is_available = TRUE);
        
        |System|
        :Generate Email Verification Token;
        
        |Email Service|
        :Send Verification Email
        to Stay Owner;
        
        |System|
        :Notify Admin of
        New Pending Stay Owner;
        
        |Email Service|
        :Send Admin Notification
        "New stay owner registration
        pending approval:
        Property: {property_name}
        Type: {stay_type}";
        
        |Stay Owner|
        :Display Success Message
        "Registration submitted!
        Please verify your email
        and wait for admin approval.";
        
        :Check Email for
        Verification Link;
        :Click Verification Link;
        
        |System|
        :Validate Token;
        
        if (Token Valid?) then (yes)
            |Database|
            :UPDATE users
            SET email_verified = TRUE
            WHERE id = {user_id};
            
            |Stay Owner|
            :Email Verified!
            Awaiting Admin Approval;
        else (no)
            |Stay Owner|
            :Display "Invalid or
            Expired Token";
        endif
    endif
else (no)
    |Stay Owner|
    :Display Validation Errors
    - Invalid email format
    - Password too weak
    - Required fields missing
    - Invalid price format
    - Invalid star rating;
endif

' === ADMIN APPROVAL WORKFLOW ===
|Admin|
:Login to Admin Portal;
:Navigate to "Pending Approvals";
:Select "Stay Owners" Tab;

|System|
:Fetch Pending Stay Owners;

|Database|
:SELECT u.*, s.*
FROM users u
JOIN stays s ON u.id = s.owner_id
WHERE u.role = 'stay_owner'
AND u.is_approved = FALSE;

|Admin|
:Review Stay Owner Application
- Property Name & Type
- Location & Address
- Star Rating
- Pricing
- Amenities Offered
- Contact Information;

if (Approve Stay Owner?) then (yes)
    :Click "Approve";
    
    |Database|
    :UPDATE users
    SET is_approved = TRUE
    WHERE id = {stay_owner_id};
    
    :UPDATE stays
    SET is_approved = TRUE
    WHERE owner_id = {stay_owner_id};
    
    |Email Service|
    :Send Approval Email
    "Congratulations! Your stay owner
    account has been approved.
    Your property is now listed
    on the Tourism Portal.";
    
    |Stay Owner|
    :Receive Approval Email;
    :Login to Stay Owner Portal;
    
    |System|
    :Grant Access to
    Stay Owner Dashboard;
    
    |Stay Owner|
    :Access Stay Owner Features
    - Edit Property Details
    - Upload Property Images
    - Manage Room Types
    - Set Availability Calendar
    - View Booking Requests
    - Manage Pricing
    - View Analytics & Reviews;
    
else (no)
    :Click "Reject";
    :Enter Rejection Reason
    (e.g., Incomplete info,
    Unverifiable property,
    Policy violation);
    
    |Database|
    :UPDATE users
    SET is_active = FALSE
    WHERE id = {stay_owner_id};
    
    :UPDATE stays
    SET is_approved = FALSE,
    rejection_reason = {reason}
    WHERE owner_id = {stay_owner_id};
    
    |Email Service|
    :Send Rejection Email
    "Your stay owner application
    was not approved.
    Reason: {rejection_reason}
    
    You may reapply after
    addressing the issues.";
    
    |Stay Owner|
    :Receive Rejection Email;
    :Review Rejection Reason;
    :May Reapply with
    Corrected Information;
endif

' === POST-APPROVAL: PROPERTY MANAGEMENT ===
|Stay Owner|
:Access Property Dashboard;

|System|
:Display Property
Management Options;

|Stay Owner|
fork
    :Update Property Details;
fork again
    :Upload Images;
fork again
    :Set Room Availability;
fork again
    :Manage Pricing;
end fork

|Database|
:UPDATE stays
SET ... WHERE owner_id = {user_id};

|System|
:Property Updated;
:Changes Reflected on
Public Tourism Portal;

|Stay Owner|
:Property Live on Platform!;

stop

@enduml
