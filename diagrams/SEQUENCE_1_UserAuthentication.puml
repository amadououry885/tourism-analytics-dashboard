@startuml User Authentication Sequence

title User Authentication (Login)

skinparam backgroundColor #FEFEFE
skinparam sequenceArrowThickness 2

actor User as U #LightBlue
participant "Frontend\n(React)" as FE #E3F2FD
participant "Backend\n(Django)" as BE #E8F5E9
database "Database" as DB #FFF3E0

U -> FE: Enter credentials
FE -> FE: Validate form
FE -> BE: POST /api/auth/login/\n{username, password}
BE -> DB: Query User by username
DB --> BE: User record

alt User not found
    BE --> FE: 401 Unauthorized
    FE --> U: "Invalid credentials"
else User found
    BE -> BE: Verify password hash
    alt Password incorrect
        BE --> FE: 401 Unauthorized
        FE --> U: "Invalid credentials"
    else Password correct
        BE -> BE: Check is_approved
        alt Not approved
            BE --> FE: 403 Forbidden
            FE --> U: "Account pending approval"
        else Approved
            BE -> BE: Generate JWT tokens
            BE --> FE: 200 OK\n{access, refresh, user}
            FE -> FE: Store tokens in localStorage
            FE --> U: Redirect to Dashboard
        end
    end
end

@enduml
